'use strict';

Object.defineProperty(exports, "__esModule", {
  value: true
});

var _defineProperty2 = require('babel-runtime/helpers/defineProperty');

var _defineProperty3 = _interopRequireDefault(_defineProperty2);

exports.defineHook = defineHook;
exports.defineStep = defineStep;
exports.registerHandler = registerHandler;
exports.addTransform = addTransform;
exports.defineParameterType = defineParameterType;

var _util = require('util');

var _util2 = _interopRequireDefault(_util);

var _lodash = require('lodash');

var _lodash2 = _interopRequireDefault(_lodash);

var _cucumberExpressions = require('cucumber-expressions');

var _helpers = require('../formatter/helpers');

var _hook_definition = require('../models/hook_definition');

var _hook_definition2 = _interopRequireDefault(_hook_definition);

var _path = require('path');

var _path2 = _interopRequireDefault(_path);

var _stacktraceJs = require('stacktrace-js');

var _stacktraceJs2 = _interopRequireDefault(_stacktraceJs);

var _step_definition = require('../models/step_definition');

var _step_definition2 = _interopRequireDefault(_step_definition);

var _validate_arguments = require('./validate_arguments');

var _validate_arguments2 = _interopRequireDefault(_validate_arguments);

function _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }

function defineHook(cwd, collection) {
  return function (options, code) {
    if (typeof options === 'string') {
      options = { tags: options };
    } else if (typeof options === 'function') {
      code = options;
      options = {};
    }

    var _getDefinitionLineAnd = getDefinitionLineAndUri(cwd),
        line = _getDefinitionLineAnd.line,
        uri = _getDefinitionLineAnd.uri;

    (0, _validate_arguments2.default)({
      args: { code: code, options: options },
      fnName: 'defineHook',
      location: (0, _helpers.formatLocation)({ line: line, uri: uri })
    });
    var hookDefinition = new _hook_definition2.default({ code: code, line: line, options: options, uri: uri });
    collection.push(hookDefinition);
  };
}

function defineStep(cwd, collection) {
  return function (pattern, options, code) {
    if (typeof options === 'function') {
      code = options;
      options = {};
    }

    var _getDefinitionLineAnd2 = getDefinitionLineAndUri(cwd),
        line = _getDefinitionLineAnd2.line,
        uri = _getDefinitionLineAnd2.uri;

    (0, _validate_arguments2.default)({
      args: { code: code, pattern: pattern, options: options },
      fnName: 'defineStep',
      location: (0, _helpers.formatLocation)({ line: line, uri: uri })
    });
    var stepDefinition = new _step_definition2.default({
      code: code,
      line: line,
      options: options,
      pattern: pattern,
      uri: uri
    });
    collection.push(stepDefinition);
  };
}

function getDefinitionLineAndUri(cwd) {
  var stackframes = _stacktraceJs2.default.getSync();
  var stackframe = stackframes.length > 2 ? stackframes[2] : stackframes[0];
  var line = stackframe.getLineNumber();
  var uri = stackframe.getFileName();
  if (uri) {
    uri = _path2.default.relative(cwd, uri.replace(/\//g, _path2.default.sep));
  } else {
    uri = 'unknown';
  }
  return { line: line, uri: uri };
}

function registerHandler(cwd, collection) {
  return function (eventName, options, code) {
    var _$assign;

    if (typeof options === 'function') {
      code = options;
      options = {};
    }

    var _getDefinitionLineAnd3 = getDefinitionLineAndUri(cwd),
        line = _getDefinitionLineAnd3.line,
        uri = _getDefinitionLineAnd3.uri;

    (0, _validate_arguments2.default)({
      args: { code: code, eventName: eventName, options: options },
      fnName: 'registerHandler',
      location: (0, _helpers.formatLocation)({ line: line, uri: uri })
    });
    var listener = _lodash2.default.assign((_$assign = {}, (0, _defineProperty3.default)(_$assign, 'handle' + eventName, code), (0, _defineProperty3.default)(_$assign, 'location', (0, _helpers.formatLocation)({ line: line, uri: uri })), _$assign), options);
    collection.push(listener);
  };
}

function addTransform(parameterTypeRegistry) {
  return _util2.default.deprecate(function (_ref) {
    var captureGroupRegexps = _ref.captureGroupRegexps,
        transformer = _ref.transformer,
        typeName = _ref.typeName;

    var parameter = new _cucumberExpressions.ParameterType(typeName, null, captureGroupRegexps, transformer);
    parameterTypeRegistry.defineParameterType(parameter);
  }, 'addTransform is deprecated and will be removed in a future version. Please use defineParameterType instead.');
}

function defineParameterType(parameterTypeRegistry) {
  return function (_ref2) {
    var regexp = _ref2.regexp,
        transformer = _ref2.transformer,
        typeName = _ref2.typeName;

    var parameter = new _cucumberExpressions.ParameterType(typeName, null, regexp, transformer);
    parameterTypeRegistry.defineParameterType(parameter);
  };
}
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi4uLy4uL3NyYy9zdXBwb3J0X2NvZGVfbGlicmFyeS9oZWxwZXJzLmpzIl0sIm5hbWVzIjpbImRlZmluZUhvb2siLCJkZWZpbmVTdGVwIiwicmVnaXN0ZXJIYW5kbGVyIiwiYWRkVHJhbnNmb3JtIiwiZGVmaW5lUGFyYW1ldGVyVHlwZSIsImN3ZCIsImNvbGxlY3Rpb24iLCJvcHRpb25zIiwiY29kZSIsInRhZ3MiLCJnZXREZWZpbml0aW9uTGluZUFuZFVyaSIsImxpbmUiLCJ1cmkiLCJhcmdzIiwiZm5OYW1lIiwibG9jYXRpb24iLCJob29rRGVmaW5pdGlvbiIsInB1c2giLCJwYXR0ZXJuIiwic3RlcERlZmluaXRpb24iLCJzdGFja2ZyYW1lcyIsImdldFN5bmMiLCJzdGFja2ZyYW1lIiwibGVuZ3RoIiwiZ2V0TGluZU51bWJlciIsImdldEZpbGVOYW1lIiwicmVsYXRpdmUiLCJyZXBsYWNlIiwic2VwIiwiZXZlbnROYW1lIiwibGlzdGVuZXIiLCJhc3NpZ24iLCJwYXJhbWV0ZXJUeXBlUmVnaXN0cnkiLCJkZXByZWNhdGUiLCJjYXB0dXJlR3JvdXBSZWdleHBzIiwidHJhbnNmb3JtZXIiLCJ0eXBlTmFtZSIsInBhcmFtZXRlciIsInJlZ2V4cCJdLCJtYXBwaW5ncyI6Ijs7Ozs7Ozs7OztRQVVnQkEsVSxHQUFBQSxVO1FBbUJBQyxVLEdBQUFBLFU7UUFvQ0FDLGUsR0FBQUEsZTtRQXVCQUMsWSxHQUFBQSxZO1FBWUFDLG1CLEdBQUFBLG1COztBQXBHaEI7Ozs7QUFDQTs7OztBQUNBOztBQUNBOztBQUNBOzs7O0FBQ0E7Ozs7QUFDQTs7OztBQUNBOzs7O0FBQ0E7Ozs7OztBQUVPLFNBQVNKLFVBQVQsQ0FBb0JLLEdBQXBCLEVBQXlCQyxVQUF6QixFQUFxQztBQUMxQyxTQUFPLFVBQUNDLE9BQUQsRUFBVUMsSUFBVixFQUFtQjtBQUN4QixRQUFJLE9BQU9ELE9BQVAsS0FBbUIsUUFBdkIsRUFBaUM7QUFDL0JBLGdCQUFVLEVBQUVFLE1BQU1GLE9BQVIsRUFB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QUZRO0FBR2hCQyxnQkFBVSw2QkFBZSxFQUFFSixVQUFGLEVBQVFDLFFBQVIsRUFBZjtBQUhNLEtBQWxCO0FBS0EsUUFBTWtCLFdBQVcsaUJBQUVDLE1BQUYsb0VBRUhGLFNBRkcsRUFFV3JCLElBRlgsdURBR0gsNkJBQWUsRUFBRUcsVUFBRixFQUFRQyxRQUFSLEVBQWYsQ0FIRyxjQUtmTCxPQUxlLENBQWpCO0FBT0FELGVBQVdXLElBQVgsQ0FBZ0JhLFFBQWhCO0FBQ0QsR0FuQkQ7QUFvQkQ7O0FBRU0sU0FBUzNCLFlBQVQsQ0FBc0I2QixxQkFBdEIsRUFBNkM7QUFDbEQsU0FBTyxlQUFLQyxTQUFMLENBQWUsZ0JBQW9EO0FBQUEsUUFBakRDLG1CQUFpRCxRQUFqREEsbUJBQWlEO0FBQUEsUUFBNUJDLFdBQTRCLFFBQTVCQSxXQUE0QjtBQUFBLFFBQWZDLFFBQWUsUUFBZkEsUUFBZTs7QUFDeEUsUUFBTUMsWUFBWSx1Q0FDaEJELFFBRGdCLEVBRWhCLElBRmdCLEVBR2hCRixtQkFIZ0IsRUFJaEJDLFdBSmdCLENBQWxCO0FBTUFILDBCQUFzQjVCLG1CQUF0QixDQUEwQ2lDLFNBQTFDO0FBQ0QsR0FSTSxFQVFKLDZHQVJJLENBQVA7QUFTRDs7QUFFTSxTQUFTakMsbUJBQVQsQ0FBNkI0QixxQkFBN0IsRUFBb0Q7QUFDekQsU0FBTyxpQkFBdUM7QUFBQSxRQUFwQ00sTUFBb0MsU0FBcENBLE1BQW9DO0FBQUEsUUFBNUJILFdBQTRCLFNBQTVCQSxXQUE0QjtBQUFBLFFBQWZDLFFBQWUsU0FBZkEsUUFBZTs7QUFDNUMsUUFBTUMsWUFBWSx1Q0FBa0JELFFBQWxCLEVBQTRCLElBQTVCLEVBQWtDRSxNQUFsQyxFQUEwQ0gsV0FBMUMsQ0FBbEI7QUFDQUgsMEJBQXNCNUIsbUJBQXRCLENBQTBDaUMsU0FBMUM7QUFDRCxHQUhEO0FBSUQiLCJmaWxlIjoiaGVscGVycy5qcyIsInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB1dGlsIGZyb20gJ3V0aWwnXG5pbXBvcnQgXyBmcm9tICdsb2Rhc2gnXG5pbXBvcnQgeyBQYXJhbWV0ZXJUeXBlIH0gZnJvbSAnY3VjdW1iZXItZXhwcmVzc2lvbnMnXG5pbXBvcnQgeyBmb3JtYXRMb2NhdGlvbiB9IGZyb20gJy4uL2Zvcm1hdHRlci9oZWxwZXJzJ1xuaW1wb3J0IEhvb2tEZWZpbml0aW9uIGZyb20gJy4uL21vZGVscy9ob29rX2RlZmluaXRpb24nXG5pbXBvcnQgcGF0aCBmcm9tICdwYXRoJ1xuaW1wb3J0IFN0YWNrVHJhY2UgZnJvbSAnc3RhY2t0cmFjZS1qcydcbmltcG9ydCBTdGVwRGVmaW5pdGlvbiBmcm9tICcuLi9tb2RlbHMvc3RlcF9kZWZpbml0aW9uJ1xuaW1wb3J0IHZhbGlkYXRlQXJndW1lbnRzIGZyb20gJy4vdmFsaWRhdGVfYXJndW1lbnRzJ1xuXG5leHBvcnQgZnVuY3Rpb24gZGVmaW5lSG9vayhjd2QsIGNvbGxlY3Rpb24pIHtcbiAgcmV0dXJuIChvcHRpb25zLCBjb2RlKSA9PiB7XG4gICAgaWYgKHR5cGVvZiBvcHRpb25zID09PSAnc3RyaW5nJykge1xuICAgICAgb3B0aW9ucyA9IHsgdGFnczogb3B0aW9ucyB9XG4gICAgfSBlbHNlIGlmICh0eXBlb2Ygb3B0aW9ucyA9PT0gJ2Z1bmN0aW9uJykge1xuICAgICAgY29kZSA9IG9wdGlvbnNcbiAgICAgIG9wdGlvbnMgPSB7fVxuICAgIH1cbiAgICBjb25zdCB7IGxpbmUsIHVyaSB9ID0gZ2V0RGVmaW5pdGlvbkxpbmVBbmRVcmkoY3dkKVxuICAgIHZhbGlkYXRlQXJndW1lbnRzKHtcbiAgICAgIGFyZ3M6IHsgY29kZSwgb3B0aW9ucyB9LFxuICAgICAgZm5OYW1lOiAnZGVmaW5lSG9vaycsXG4gICAgICBsb2NhdGlvbjogZm9ybWF0TG9jYXRpb24oeyBsaW5lLCB1cmkgfSlcbiAgICB9KVxuICAgIGNvbnN0IGhvb2tEZWZpbml0aW9uID0gbmV3IEhvb2tEZWZpbml0aW9uKHsgY29kZSwgbGluZSwgb3B0aW9ucywgdXJpIH0pXG4gICAgY29sbGVjdGlvbi5wdXNoKGhvb2tEZWZpbml0aW9uKVxuICB9XG59XG5cbmV4cG9ydCBmdW5jdGlvbiBkZWZpbmVTdGVwKGN3ZCwgY29sbGVjdGlvbikge1xuICByZXR1cm4gKHBhdHRlcm4sIG9wdGlvbnMsIGNvZGUpID0+IHtcbiAgICBpZiAodHlwZW9mIG9wdGlvbnMgPT09ICdmdW5jdGlvbicpIHtcbiAgICAgIGNvZGUgPSBvcHRpb25zXG4gICAgICBvcHRpb25zID0ge31cbiAgICB9XG4gICAgY29uc3QgeyBsaW5lLCB1cmkgfSA9IGdldERlZmluaXRpb25MaW5lQW5kVXJpKGN3ZClcbiAgICB2YWxpZGF0ZUFyZ3VtZW50cyh7XG4gICAgICBhcmdzOiB7IGNvZGUsIHBhdHRlcm4sIG9wdGlvbnMgfSxcbiAgICAgIGZuTmFtZTogJ2RlZmluZVN0ZXAnLFxuICAgICAgbG9jYXRpb246IGZvcm1hdExvY2F0aW9uKHsgbGluZSwgdXJpIH0pXG4gICAgfSlcbiAgICBjb25zdCBzdGVwRGVmaW5pdGlvbiA9IG5ldyBTdGVwRGVmaW5pdGlvbih7XG4gICAgICBjb2RlLFxuICAgICAgbGluZSxcbiAgICAgIG9wdGlvbnMsXG4gICAgICBwYXR0ZXJuLFxuICAgICAgdXJpXG4gICAgfSlcbiAgICBjb2xsZWN0aW9uLnB1c2goc3RlcERlZmluaXRpb24pXG4gIH1cbn1cblxuZnVuY3Rpb24gZ2V0RGVmaW5pdGlvbkxpbmVBbmRVcmkoY3dkKSB7XG4gIGNvbnN0IHN0YWNrZnJhbWVzID0gU3RhY2tUcmFjZS5nZXRTeW5jKClcbiAgY29uc3Qgc3RhY2tmcmFtZSA9IHN0YWNrZnJhbWVzLmxlbmd0aCA+IDIgPyBzdGFja2ZyYW1lc1syXSA6IHN0YWNrZnJhbWVzWzBdXG4gIGNvbnN0IGxpbmUgPSBzdGFja2ZyYW1lLmdldExpbmVOdW1iZXIoKVxuICBsZXQgdXJpID0gc3RhY2tmcmFtZS5nZXRGaWxlTmFtZSgpXG4gIGlmICh1cmkpIHtcbiAgICB1cmkgPSBwYXRoLnJlbGF0aXZlKGN3ZCwgdXJpLnJlcGxhY2UoL1xcLy9nLCBwYXRoLnNlcCkpXG4gIH0gZWxzZSB7XG4gICAgdXJpID0gJ3Vua25vd24nXG4gIH1cbiAgcmV0dXJuIHsgbGluZSwgdXJpIH1cbn1cblxuZXhwb3J0IGZ1bmN0aW9uIHJlZ2lzdGVySGFuZGxlcihjd2QsIGNvbGxlY3Rpb24pIHtcbiAgcmV0dXJuIChldmVudE5hbWUsIG9wdGlvbnMsIGNvZGUpID0+IHtcbiAgICBpZiAodHlwZW9mIG9wdGlvbnMgPT09ICdmdW5jdGlvbicpIHtcbiAgICAgIGNvZGUgPSBvcHRpb25zXG4gICAgICBvcHRpb25zID0ge31cbiAgICB9XG4gICAgY29uc3QgeyBsaW5lLCB1cmkgfSA9IGdldERlZmluaXRpb25MaW5lQW5kVXJpKGN3ZClcbiAgICB2YWxpZGF0ZUFyZ3VtZW50cyh7XG4gICAgICBhcmdzOiB7IGNvZGUsIGV2ZW50TmFtZSwgb3B0aW9ucyB9LFxuICAgICAgZm5OYW1lOiAncmVnaXN0ZXJIYW5kbGVyJyxcbiAgICAgIGxvY2F0aW9uOiBmb3JtYXRMb2NhdGlvbih7IGxpbmUsIHVyaSB9KVxuICAgIH0pXG4gICAgY29uc3QgbGlzdGVuZXIgPSBfLmFzc2lnbihcbiAgICAgIHtcbiAgICAgICAgW2BoYW5kbGUke2V2ZW50TmFtZX1gXTogY29kZSxcbiAgICAgICAgbG9jYXRpb246IGZvcm1hdExvY2F0aW9uKHsgbGluZSwgdXJpIH0pXG4gICAgICB9LFxuICAgICAgb3B0aW9uc1xuICAgIClcbiAgICBjb2xsZWN0aW9uLnB1c2gobGlzdGVuZXIpXG4gIH1cbn1cblxuZXhwb3J0IGZ1bmN0aW9uIGFkZFRyYW5zZm9ybShwYXJhbWV0ZXJUeXBlUmVnaXN0cnkpIHtcbiAgcmV0dXJuIHV0aWwuZGVwcmVjYXRlKCh7IGNhcHR1cmVHcm91cFJlZ2V4cHMsIHRyYW5zZm9ybWVyLCB0eXBlTmFtZSB9KSA9PiB7XG4gICAgY29uc3QgcGFyYW1ldGVyID0gbmV3IFBhcmFtZXRlclR5cGUoXG4gICAgICB0eXBlTmFtZSxcbiAgICAgIG51bGwsXG4gICAgICBjYXB0dXJlR3JvdXBSZWdleHBzLFxuICAgICAgdHJhbnNmb3JtZXJcbiAgICApXG4gICAgcGFyYW1ldGVyVHlwZVJlZ2lzdHJ5LmRlZmluZVBhcmFtZXRlclR5cGUocGFyYW1ldGVyKVxuICB9LCAnYWRkVHJhbnNmb3JtIGlzIGRlcHJlY2F0ZWQgYW5kIHdpbGwgYmUgcmVtb3ZlZCBpbiBhIGZ1dHVyZSB2ZXJzaW9uLiBQbGVhc2UgdXNlIGRlZmluZVBhcmFtZXRlclR5cGUgaW5zdGVhZC4nKVxufVxuXG5leHBvcnQgZnVuY3Rpb24gZGVmaW5lUGFyYW1ldGVyVHlwZShwYXJhbWV0ZXJUeXBlUmVnaXN0cnkpIHtcbiAgcmV0dXJuICh7IHJlZ2V4cCwgdHJhbnNmb3JtZXIsIHR5cGVOYW1lIH0pID0+IHtcbiAgICBjb25zdCBwYXJhbWV0ZXIgPSBuZXcgUGFyYW1ldGVyVHlwZSh0eXBlTmFtZSwgbnVsbCwgcmVnZXhwLCB0cmFuc2Zvcm1lcilcbiAgICBwYXJhbWV0ZXJUeXBlUmVnaXN0cnkuZGVmaW5lUGFyYW1ldGVyVHlwZShwYXJhbWV0ZXIpXG4gIH1cbn1cbiJdfQ==